@model List<_22DH114699_LTW.Models.Product>

@if (Model != null && Model.Any())
{
    <div id="similarProductsCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            @{
                var productsPerSlide = 6;
                var totalSlides = (int)Math.Ceiling((double)Model.Count / productsPerSlide);
                
                for (int slideIndex = 0; slideIndex < totalSlides; slideIndex++)
                {
                    var productsInSlide = Model.Skip(slideIndex * productsPerSlide).Take(productsPerSlide).ToList();
                    var isActive = slideIndex == 0 ? "active" : "";
                    
                    <div class="carousel-item @isActive">
                        <div class="row row-cols-2 row-cols-md-6 g-3">
                            @foreach (var product in productsInSlide)
                            {
                                string imgPath;
                                if (string.IsNullOrEmpty(product.ProductImage))
                                {
                                    imgPath = Url.Content("~/Images/no-image.png");
                                }
                                else if (product.ProductImage.StartsWith("http://") || product.ProductImage.StartsWith("https://"))
                                {
                                    imgPath = product.ProductImage;
                                }
                                else if (product.ProductImage.StartsWith("~") || product.ProductImage.StartsWith("/"))
                                {
                                    imgPath = Url.Content(product.ProductImage);
                                }
                                else
                                {
                                    imgPath = Url.Content("~/Images/" + product.ProductImage);
                                }
                                
                                <div class="col">
                                    <div class="card h-100 border shadow-sm product-card">
                                        <img class="card-img-top" src="@imgPath" alt="@product.ProductName" style="height: 200px; object-fit: cover;" />
                                        <div class="card-body p-3">
                                            <div class="text-primary fw-bold mb-2" style="font-size: 1rem;">
                                                @String.Format("{0:N0}", product.ProductPrice) ?
                                            </div>
                                            <h6 class="card-title mb-2" style="font-size: 0.85rem; line-height: 1.3; height: 2.6rem; overflow: hidden;">
                                                @product.ProductName
                                            </h6>
                                            <div class="text-muted small mb-1">
                                                @(product.Category != null ? product.Category.CategoryName : "Ch?a phân lo?i")
                                            </div>
                                        </div>
                                        <div class="card-footer bg-white border-0 p-2 pt-0">
                                            <a class="btn btn-sm btn-outline-primary w-100" href="@Url.Action("ProductDetail", "Home", new { id = product.ProductID })">
                                                Xem chi ti?t
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            }
        </div>
        
        @if (totalSlides > 1)
        {
            <button class="carousel-control-prev" type="button" data-bs-target="#similarProductsCarousel" data-bs-slide="prev" style="width: 5%; margin-left: -50px;">
                <span class="carousel-control-prev-icon bg-dark rounded-circle p-3" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#similarProductsCarousel" data-bs-slide="next" style="width: 5%; margin-right: -50px;">
                <span class="carousel-control-next-icon bg-dark rounded-circle p-3" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
            
            <div class="carousel-indicators position-relative mt-3" style="margin-bottom: 0;">
                @for (int i = 0; i < totalSlides; i++)
                {
                    var activeClass = i == 0 ? "active" : "";
                    <button type="button" data-bs-target="#similarProductsCarousel" data-bs-slide-to="@i" class="@activeClass bg-dark" aria-label="Slide @(i + 1)"></button>
                }
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> Không có s?n ph?m t??ng t?
    </div>
}

<style>
    .product-card {
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
    }
    
    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        filter: invert(1);
    }
</style>
